{"ast":null,"code":"var _jsxFileName = \"/Users/ericboris/Developer/CSE442/a4/src/components/Blockchain/SingleBlock.js\";\nimport React, { Component } from 'react';\nimport { Container, Form } from 'react-bootstrap';\nimport { sha256 } from 'js-sha256';\nimport { NumberField, ReadOnlyTextField, TextAreaField } from '../Fields';\nimport { MineButton, mine } from '../MineButton';\nimport MineSettings from '../MineSettings'; // Parse the mining settings.\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst difficulty = MineSettings.difficulty;\nconst pattern = MineSettings.pattern;\n\nclass SingleBlock extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getHashableBlock = block => Object.fromEntries(Object.entries(block).filter(_ref => {\n      let [key] = _ref;\n      return key !== 'hash';\n    }));\n\n    this.isSigned = hash => hash.substr(0, difficulty) === pattern ? true : false;\n\n    this.setBlockNumber = blockNumber => this.setState({\n      block: { ...this.state.block,\n        blockNumber\n      }\n    });\n\n    this.setNonce = nonce => this.setState({\n      block: { ...this.state.block,\n        nonce\n      }\n    });\n\n    this.setData = data => this.setState({\n      block: { ...this.state.block,\n        data\n      }\n    });\n\n    this.setPrevHash = prevHash => this.setState({\n      block: { ...this.state.block,\n        prevHash\n      }\n    });\n\n    this.setHash = hash => this.setState({\n      block: { ...this.state.block,\n        hash\n      }\n    });\n\n    this.state = {\n      index: props.index,\n      block: props.block,\n      color: \"#50c878\",\n      signed: true\n    };\n  } // Return a hashable block with fields that shouldn't be hashed removed.\n\n\n  /* Given a block return its hash.\n   * Assumes the block only contains fields that should be hashed plus \n   * a hash field, which is excluded.\n   */\n  getHash(block) {\n    // If one exists, remove a 'hash' field from the block.\n    let hashableBlock = this.getHashableBlock(block);\n    console.log(\"F BLOCK: \", hashableBlock); // And concatenate the remaining field values into a string.\n\n    let str = Object.values(hashableBlock).map(field => field.toString()).join('');\n    console.log(\"STR: \", str);\n    let result = sha256(str);\n    console.log(\"RESULT: \", result);\n    return sha256(str);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const prevHash = this.props.prevHash;\n\n    if (prevHash !== prevState.block.preHash) {\n      this.setPrevHash(prevHash);\n    } // If this hash has changed, update the hash and notify the caller.\n\n\n    const hash = this.getHash(this.state.block);\n\n    if (prevState.block.hash !== hash) {\n      this.setHash(hash);\n    }\n\n    let signed = this.isSigned(hash);\n\n    if (prevState.signed !== signed) {\n      this.setState({\n        signed\n      });\n      this.setState({\n        color: signed ? '#50c878' : '#ff0000'\n      });\n    }\n\n    if (prevState.block != this.state.block) {\n      this.props.callback({\n        index: this.state.index,\n        block: this.state.block\n      });\n    }\n  } // Define a collection of functions for updating this block's fields.\n\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      children: /*#__PURE__*/_jsxDEV(Container, {\n        style: {\n          'width': 350,\n          'height': 500,\n          'background-color': this.state.color\n        },\n        children: /*#__PURE__*/_jsxDEV(Form, {\n          children: [/*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(NumberField, {\n            label: 'Block Number:',\n            value: this.state.block.blockNumber,\n            callback: blockNumber => this.setBlockNumber(blockNumber)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(NumberField, {\n            label: 'Nonce:',\n            value: this.state.block.nonce,\n            callback: nonce => this.setNonce(nonce)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(TextAreaField, {\n            label: 'Data:',\n            callback: data => this.setData(data)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(ReadOnlyTextField, {\n            label: 'Previous Hash:',\n            value: this.props.block.prevHash,\n            callback: prevHash => this.setPrevHash(prevHash)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(ReadOnlyTextField, {\n            label: 'Hash:',\n            value: this.state.block.hash,\n            callback: hash => this.setHash(hash)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 108,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(MineButton, {\n            blockNumber: this.props.block.blockNumber,\n            data: this.props.block.data,\n            prevHash: this.props.block.prevHash,\n            callback: nonce => this.setNonce({\n              nonce\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default SingleBlock;","map":{"version":3,"sources":["/Users/ericboris/Developer/CSE442/a4/src/components/Blockchain/SingleBlock.js"],"names":["React","Component","Container","Form","sha256","NumberField","ReadOnlyTextField","TextAreaField","MineButton","mine","MineSettings","difficulty","pattern","SingleBlock","constructor","props","getHashableBlock","block","Object","fromEntries","entries","filter","key","isSigned","hash","substr","setBlockNumber","blockNumber","setState","state","setNonce","nonce","setData","data","setPrevHash","prevHash","setHash","index","color","signed","getHash","hashableBlock","console","log","str","values","map","field","toString","join","result","componentDidUpdate","prevProps","prevState","preHash","callback","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { Container, Form } from 'react-bootstrap';\nimport { sha256 } from 'js-sha256';\nimport { NumberField, ReadOnlyTextField, TextAreaField } from '../Fields';\nimport { MineButton, mine } from '../MineButton';\nimport MineSettings from '../MineSettings';\n\n// Parse the mining settings.\nconst difficulty = MineSettings.difficulty;\nconst pattern = MineSettings.pattern;\n\nclass SingleBlock extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            index: props.index,\n            block: props.block,\n            color: \"#50c878\",\n            signed: true\n        };\n    }\n\n    // Return a hashable block with fields that shouldn't be hashed removed.\n    getHashableBlock = (block) => Object.fromEntries(Object.entries(block).filter(([key]) => key !== 'hash'));\n\n    // Returns true if the hash is signed and false otherwise.\n    isSigned = (hash) => (hash.substr(0, difficulty) === pattern) ? true : false;\n\n    /* Given a block return its hash.\n     * Assumes the block only contains fields that should be hashed plus \n     * a hash field, which is excluded.\n     */\n    getHash(block) {\n        // If one exists, remove a 'hash' field from the block.\n        let hashableBlock = this.getHashableBlock(block);\n        console.log(\"F BLOCK: \", hashableBlock);\n        // And concatenate the remaining field values into a string.\n        let str = Object.values(hashableBlock).map(field => field.toString()).join('');\n        console.log(\"STR: \", str);\n        let result = sha256(str);\n        console.log(\"RESULT: \", result);\n        return sha256(str);\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        const prevHash = this.props.prevHash;\n        if (prevHash !== prevState.block.preHash) {\n           this.setPrevHash(prevHash); \n        }\n\n        // If this hash has changed, update the hash and notify the caller.\n        const hash = this.getHash(this.state.block);\n        if (prevState.block.hash !== hash) {\n            this.setHash(hash);\n                }\n    \n        \n\n        let signed = this.isSigned(hash);\n        if (prevState.signed !== signed) {\n            this.setState({signed});\n            this.setState({color: signed ? '#50c878' : '#ff0000'});\n        }\n\n        if (prevState.block != this.state.block) {\n            this.props.callback({index: this.state.index, block: this.state.block});\n        }\n    }\n\n    // Define a collection of functions for updating this block's fields.\n    setBlockNumber = (blockNumber) => this.setState({ block: { ...this.state.block, blockNumber } });\n    setNonce = (nonce) => this.setState({ block: { ...this.state.block, nonce } });\n    setData = (data) => this.setState({ block: { ...this.state.block, data } });\n    setPrevHash = (prevHash) => this.setState({ block: { ...this.state.block, prevHash } });\n    setHash = (hash) => this.setState({ block: { ...this.state.block, hash } });\n\n    render() {\n        return (\n            <Container>\n                <Container\n                    style={{\n                        'width':350,\n                        'height':500,\n                        'background-color':this.state.color,\n                    }}\n                >\n                    <Form>\n                        <br/>\n                        <NumberField\n                            label={'Block Number:'}\n                            value={this.state.block.blockNumber}\n                            callback={(blockNumber) => this.setBlockNumber(blockNumber)}\n                        />\n                        <NumberField\n                            label={'Nonce:'}\n                            value={this.state.block.nonce}\n                            callback={(nonce) => this.setNonce(nonce)}\n                        />\n                        <TextAreaField\n                            label={'Data:'}\n                            callback={(data) => this.setData(data)}\n                        />\n                        <ReadOnlyTextField\n                            label={'Previous Hash:'}\n                            value={this.props.block.prevHash}\n                            callback={(prevHash) => this.setPrevHash(prevHash)}\n                        />\n                        <ReadOnlyTextField\n                            label={'Hash:'}\n                            value={this.state.block.hash}\n                            callback={(hash) => this.setHash(hash)}\n                        />\n                        <br/>\n                        <MineButton\n                            blockNumber={this.props.block.blockNumber}\n                            data={this.props.block.data}\n                            prevHash={this.props.block.prevHash}\n                            callback={(nonce) => this.setNonce({nonce})}\n                        />\n                    </Form>\n                </Container>\n            </Container>\n        );\n    }\n}\n\nexport default SingleBlock;\n"]},"metadata":{},"sourceType":"module"}